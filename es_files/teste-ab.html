<!DOCTYPE html>
<!-- saved from url=(2241)https://s3.glbimg.com/v1/AUTH_14ce1dbebbe64b1e8e955809a085692d/web-components/teste-ab.html?urls=eyJ1cmwiOiJodHRwczovL3MzLmdsYmltZy5jb20vdjEvQVVUSF8xNGNlMWRiZWJiZTY0YjFlOGU5NTU4MDlhMDg1NjkyZC93ZWItY29tcG9uZW50cy9wcm9kL3dpZGdldC5odG1sP3Byb2R1Y3ROYW1lPWcxJnByb2R1Y3RDb2xvcj0lMjNDNDE3MEMmYXJ0d29ya1VSTD1odHRwcyUzQSUyRiUyRnMzLmdsYmltZy5jb20lMkZ2MSUyRkFVVEhfNTllZGQ0MjJjMGM4NGE4NzliZDM3NjcwYWU0ZjUzOGElMkZhdWRpb3B1Yi1wb2RjYXN0cyUyRmJzJTJGMjAyMCUyRmolMkZCJTJGcm1RQWVsUUxpSGdBY3RQUlRzOFElMkZvLWFzc3VudG8uanBnJmF1ZGlvVVJMPWh0dHBzJTNBJTJGJTJGdHJhZmZpYy5vbW55LmZtJTJGZCUyRmNsaXBzJTJGNjUxYTI1MWUtMDZlMS00N2UwLTkzMzYtYWM1YTAwZjQxNjI4JTJGMDQ1NjFiNDMtNzUzZC00Nzg0LThlMTktYWM4YjAwZTg2NDExJTJGODc0MmZkNzItMjE4Yi00NDA0LWFiZTQtYWQzZDAwMzViYjI2JTJGYXVkaW8ubXAzJmR1cmF0aW9uPTE1NzQuNDI2JmF1dGhvcj1HMSZlcGlzb2RlVGl0bGU9QStvZmVuc2l2YStwZWxhK2ltcHJlc3MlQzMlQTNvK2RvK3ZvdG8rJnBvZGNhc3RUaXRsZT1PK0Fzc3VudG8mcHVibGlzaGVkQXQ9MjAyMS0wNi0wNFQwMyUzQTE2JTNBMzBaJnNoYXJlVXJsPWh0dHBzJTNBJTJGJTJGZzEuZ2xvYm8uY29tJTJGcG9kY2FzdCUyRm8tYXNzdW50byUyRiIsInVybF9vbW55IjoiaHR0cHM6Ly9vbW55LmZtL3Nob3dzL28tYXNzdW50by0xL2Etb2ZlbnNpdmEtcGVsYS1pbXByZXNzLW8tZG8tdm90by9lbWJlZD9zdHlsZT1hcnR3b3JrJmltYWdlPTEmc2hhcmU9MCZkb3dubG9hZD0wJmRlc2NyaXB0aW9uPTAmc3Vic2NyaWJlPTAmZm9yZWdyb3VuZD0wMDAwMDAmYmFja2dyb3VuZD1mMmYyZjImZGlzdD1nMS1sJmhpZ2hsaWdodD1DNDE3MEMiLCJ1cmxfcmMiOiJodHRwczovL3MzLmdsYmltZy5jb20vdjEvQVVUSF8xNGNlMWRiZWJiZTY0YjFlOGU5NTU4MDlhMDg1NjkyZC93ZWItY29tcG9uZW50cy9wcm9kL3dpZGdldC1yYy5odG1sP3Byb2R1Y3ROYW1lPWcxJnByb2R1Y3RDb2xvcj0lMjNDNDE3MEMmYXJ0d29ya1VSTD1odHRwcyUzQSUyRiUyRnMzLmdsYmltZy5jb20lMkZ2MSUyRkFVVEhfNTllZGQ0MjJjMGM4NGE4NzliZDM3NjcwYWU0ZjUzOGElMkZhdWRpb3B1Yi1wb2RjYXN0cyUyRmJzJTJGMjAyMCUyRmolMkZCJTJGcm1RQWVsUUxpSGdBY3RQUlRzOFElMkZvLWFzc3VudG8uanBnJmF1ZGlvVVJMPWh0dHBzJTNBJTJGJTJGdHJhZmZpYy5vbW55LmZtJTJGZCUyRmNsaXBzJTJGNjUxYTI1MWUtMDZlMS00N2UwLTkzMzYtYWM1YTAwZjQxNjI4JTJGMDQ1NjFiNDMtNzUzZC00Nzg0LThlMTktYWM4YjAwZTg2NDExJTJGODc0MmZkNzItMjE4Yi00NDA0LWFiZTQtYWQzZDAwMzViYjI2JTJGYXVkaW8ubXAzJmR1cmF0aW9uPTE1NzQuNDI2JmF1dGhvcj1HMSZlcGlzb2RlVGl0bGU9QStvZmVuc2l2YStwZWxhK2ltcHJlc3MlQzMlQTNvK2RvK3ZvdG8rJnBvZGNhc3RUaXRsZT1PK0Fzc3VudG8mcHVibGlzaGVkQXQ9MjAyMS0wNi0wNFQwMyUzQTE2JTNBMzBaJnNoYXJlVXJsPWh0dHBzJTNBJTJGJTJGZzEuZ2xvYm8uY29tJTJGcG9kY2FzdCUyRm8tYXNzdW50byUyRiJ9&channel=desktop -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
    <style>
        html,
        body,
        iframe {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <iframe id="podcast-iframe" frameborder="0" scrolling="no" width="320" height="210" referrerpolicy="origin" src="./widget.html"></iframe>

    <script type="text/javascript" src="./globo-ab.min.js.download"></script>
    <script type="text/javascript" src="./player-0.0.12.min.js.download"></script>
    <script>
        const urlsParam = window.location.search.match(/urls=([a-zA-Z0-9+/]+={0,2})/)[1]
        const channelParam = window.location.search.match(/channel=([a-zA-Z0-9_]+)/)[1]

        const urls = JSON.parse(atob(urlsParam))
        urls.url += '&channel=' + channelParam
        urls.url_rc += '&channel=' + channelParam

        const experiment = 'AUDIOPUB-PLAYER-CLONED-LAYOUT-CONVERSION'
        const TestGroupParameters = {
            url: 'j',
            url_rc: 'k',
            url_omny: 'l',
        }
        const UriParameters = {
            control: 'url',
            'alternative-rc': 'url_rc',
            'alternative-omny': 'url_omny',
        }

        function chooseUriParameter(alternative) {
            console.log('audioPub => chooseUriParameter')

            const uriParameter = UriParameters[alternative]
            if(uriParameter) return uriParameter
            throw new Error(`Unknow alternative: ${alternative}`)
        }

        function getTestGroupParameter(alternativeParam) {
            return TestGroupParameters[alternativeParam]
        }

        function setIframeSource(uriParameter, testGroup = '') {
            console.log('audioPub => set iframe parameter: ', uriParameter)
            const iframeList = document.querySelectorAll('#podcast-iframe')

            iframeList.forEach((iframe) => {
                const uri = urls[uriParameter]
                iframe.src = testGroup ? `${uri}&testgroup=${testGroup}` : uri
            })
        }

        window.addEventListener('load', async () => {
            let shouldCallConversion = true

            function callConversion(audiopubChosenExperiment) {
                if (shouldCallConversion) {
                    audiopubChosenExperiment.conversion()
                    shouldCallConversion = false
                }
            }

            console.log('audioPub => iniciando sorteio de player')
            try {
                const audiopubABTest = new GloboAB('prod')
                const audiopubChosenExperiment = await audiopubABTest.choose(experiment)
                const { alternative } = audiopubChosenExperiment
                const uriParameter = chooseUriParameter(alternative)
                const testGroupParameter = getTestGroupParameter(uriParameter)

                setIframeSource(uriParameter, testGroupParameter)

                if (alternative === 'alternative-omny') {
                    const audioPubList = document.querySelectorAll('#podcast-iframe')

                    audioPubList.forEach((iframe) => {
                        const player = new playerjs.Player(iframe)

                        player.on('play', () => {
                            callConversion(audiopubChosenExperiment)
                        })
                    })
                } else {
                    window.addEventListener('message', (event) => {
                        if (event.data === 'playback-update') {
                            callConversion(audiopubChosenExperiment)
                        }
                    })
                }
            } catch (e) {
                console.error('audioPub GloboAB=> ', e.message)
                setIframeSource(UriParameters.control)
            }

            window.postMessage('podcasts loaded', '*')
        })
    </script>



</body></html>